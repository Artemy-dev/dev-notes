# Партиционирование больших таблиц

**Партиционирование** - это разделение одной большой таблицы в базе данных на несколько меньших частей (**партиций**) по определённому правилу.

**Представьте себе огромное хранилище документами:**

- **Без партиционирования:** Все документы свалены в одну стопку. Чтобы найти документ за 2024 год, нужно перерыть всё.
- **С партиционированием:** Документы разложены по папкам по годам: "2023", "2024", "2025". Нужный документ ищется только в одной папке.

**Технически** - это всё ещё одна логическая таблица для приложения, но физически данные хранятся отдельно.

---

## Для чего применяется?

| **Проблема**	| **Решение через партиционирование** |
|-----------|---------------------------------|
| Медленные запросы в огромной таблице | Запрос обрабатывает не всю таблицу, а только нужную часть (партицию) |
| Сложность управления старыми данными | Старые партиции можно быстро архивировать или удалять (`DROP PARTITION`) |
| Нагрузка на диск | Можно хранить редкоиспользуемые партиции на HDD, а активные на SSD |

**Основные типы партиционирования:**

- **По диапазону (RANGE):** По дате (created_at), по цифровому диапазону (user_id)
- **По списку (LIST):** По регионам (region_id), по типам (order_type)

---

## Пример "большой" таблицы

Допустим, у нас таблица заказов интернет-магазина, которая выросла до 100+ миллионов строк:

| id |	user_id |	amount |	status |	created_at |
|---|---|---|---|---|
| 1 |	42 |	1499.99 |	'completed' |	'2023-01-15 12:30:00' |
| ... |	... |	... |	... |	... |
| 500000 |	18 |	599.50 |	'pending' |	'2024-08-21 18:15:22' |
| ... |	... |	... |	... |	... |
| 1000000 |	921 |	1899.00 |	'completed' |	'2025-03-09 09:05:33' |


```sql
CREATE TABLE orders (
    id BIGSERIAL PRIMARY KEY,
    user_id INTEGER NOT NULL,
    amount DECIMAL(10,2),
    status VARCHAR(50),
    created_at TIMESTAMP DEFAULT NOW()
);
```

**Проблемные запросы:**

```sql
SELECT * FROM orders WHERE created_at BETWEEN '2024-01-01' AND '2024-03-01';
```

- Полное сканирование таблицы

```sql
DELETE FROM orders WHERE created_at < '2024-01-01';
```

- Таблица блокируется на запись на всё время выполнения
- Запрос может быть прерван по таймауту














